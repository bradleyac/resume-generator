@using Fluxor
@using RGS.Frontend.Store.EditResumeDataFeature
<div class="my-4 d-flex flex-column gap-4">
  @foreach (var (proj, index) in Projects.WithIndex())
  {
    <div class="d-flex flex-column border p-3 position-relative">
      <Badge style="aspect-ratio: 1 / 1; display: flex; place-items: center" IndicatorType="BadgeIndicatorType.RoundedCircle" Color="BadgeColor.Danger" Position="Position.Absolute" Placement="BadgePlacement.TopLeft" @onclick="@(() => Dispatcher.Dispatch(new RemoveProjectAction(index)))">
        <Icon Name="IconName.XLg" />
      </Badge>

      <ProjectEditor @key="index" Project="proj" ProjectIndex="index" />
    </div>
  }
  <div class="d-flex gap-2 place-items-center">
    <Button Type="ButtonType.Button" Color="ButtonColor.Primary" @onclick="@(() => Dispatcher.Dispatch(new AddProjectAction()))">Add Project</Button>
  </div>
</div>

@code {
  [Parameter] public required Project[] Projects { get; set; } = [];
  [Inject] private IDispatcher Dispatcher { get; set; } = null!;
  // TODO: Adding an empty project is a poor experience right now--not validated immediately so validations suddenly appear when you start typing for fields you haven't touched
  // Also, we probably shouldn't save empty projects. Valid before saving.
  // Maybe a WONTFIX? Would need additional form boilerplate to add without saving, and this is good enough for me.
}