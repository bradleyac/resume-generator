@using BlazorBootstrap
@using RGS.Backend.Shared.ViewModels


<div>
  <FormField @bind-Value="@(Model.Label)" class="col-3" Label=@($"Skill Category") />
  <div class="mb-3 d-flex flex-wrap gap-3">
    @foreach (var (item, index) in @Model.Items.WithIndex())
    {
      <Badge @key="@index" Color="BadgeColor.Success" Position="Position.Relative">@item.Value<Badge style="aspect-ratio: 1 / 1; display: flex; place-items: center" IndicatorType="BadgeIndicatorType.RoundedCircle" Color="BadgeColor.Danger" Position="Position.Absolute" Placement="BadgePlacement.TopLeft" @onclick="() => OnSkillRemoved.InvokeAsync(index)">
          <Icon Name="IconName.XLg" />
        </Badge>
      </Badge>
    }
  </div>
  <div class="d-flex gap-2 place-items-center">
    <label for="@newSkillId" class="collapse">Add Skill</label>
    <input id="@newSkillId" type="text" class="col-sm-6 col-md-4 col-lg-3" @bind-value="@NewSkill" @bind-value:event="oninput" />
    <Button Type="ButtonType.Button" Color="ButtonColor.Primary" disabled="@(NewSkill is null or "")" @onclick="@OnClick">Add Skill</Button>
  </div>
</div>

@code {
  [Parameter] public required SkillCategoryModel Model { get; set; }
  // TODO: Replace these with a ModelChanged eventcallback and handle add/remove here?
  [Parameter] public required EventCallback<BindableString> OnSkillAdded { get; set; }
  [Parameter] public required EventCallback<int> OnSkillRemoved { get; set; }
  private string NewSkill { get; set; } = "";
  private string newSkillId = Guid.NewGuid().ToString();

  private async Task OnClick()
  {
    string newSkill = NewSkill;
    NewSkill = "";
    await OnSkillAdded.InvokeAsync(new BindableString { Value = newSkill });
  }
}